install.packages("googlesheets4")
library(googlesheets4)
# CHANGE THIS TO THE FOLDER YOU ARE WORKING IN ON YOUR COMPUTER !!!!!!!!!!!!!!
setwd('C:/Users/kiera/Work/NE_work/Species_list')
dir <- './dataframes/'
BSBI_species <- read_excel(paste(dir, 'BSBI_plant_names.xlsx', sep=''), sheet = "LIST2007")
B_sList <- BSBI_species[['Species']]
VESPAN_species <- read.csv(paste(dir, 'ECN_VESPAN_dictionary.csv', sep=''))
V_sList <- VESPAN_species[['DESC_LATIN']]
full_species_list <- c(B_sList, V_sList) %>%
map_chr(append_str2, ' sp', '.') %>%
c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
map_chr(append_str, ' sp.') %>%
c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
map_chr(append_str, ' seedling') %>%
unique() %>%
sort()
library(tidyverse)
library(readxl) # reading in the excel files
library(stringr) # capitalising the first letter of a string
library(openxlsx) # writing the data to an excel file
library(stringdist) # matching strings in the rename function
library(plyr) # mapvalues in the name swap
library(googlesheets4)
# CHANGE THIS TO THE FOLDER YOU ARE WORKING IN ON YOUR COMPUTER !!!!!!!!!!!!!!
setwd('C:/Users/kiera/Work/NE_work/Species_list')
dir <- './dataframes/'
BSBI_species <- read_excel(paste(dir, 'BSBI_plant_names.xlsx', sep=''), sheet = "LIST2007")
B_sList <- BSBI_species[['Species']]
VESPAN_species <- read.csv(paste(dir, 'ECN_VESPAN_dictionary.csv', sep=''))
V_sList <- VESPAN_species[['DESC_LATIN']]
full_species_list <- c(B_sList, V_sList) %>%
map_chr(append_str2, ' sp', '.') %>%
c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
map_chr(append_str, ' sp.') %>%
c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
map_chr(append_str, ' seedling') %>%
unique() %>%
sort()
rename <- function(input, list_of_species, naming_cutoff = 0.1) {
# Makes automatic name changes where the name is close to the names in a list
# of accepted names in MAVIS
if ( (!input %in% list_of_species) & (!is.na(input)) ) {
list_of_matches <- stringdist(input, list_of_species, method='jw')
if (min(list_of_matches) < naming_cutoff) {
new_name <- list_of_species[which.min(list_of_matches)]
return(new_name)
} else {
return(NA)
}
} else {
return(input)
}
}
append_str <- function(input, suffix) {
# Appends ' sp.' after species names when there is only one word
# because it is a genus
if (!grepl(' ', input)) {
return(paste(input, suffix, sep = ''))
} else {
return(input)
}
}
append_str2 <- function(input, find, suffix) {
# usesd for adding a '.' after a 'sp'
reg <- paste(find, '$', sep='')
if (grepl(reg, input)) {
return(paste(input, suffix, sep = ''))
} else {
return(input)
}
}
# CHANGE THIS TO THE FOLDER YOU ARE WORKING IN ON YOUR COMPUTER !!!!!!!!!!!!!!
setwd('C:/Users/kiera/Work/NE_work/Species_list')
dir <- './dataframes/'
BSBI_species <- read_excel(paste(dir, 'BSBI_plant_names.xlsx', sep=''), sheet = "LIST2007")
B_sList <- BSBI_species[['Species']]
VESPAN_species <- read.csv(paste(dir, 'ECN_VESPAN_dictionary.csv', sep=''))
V_sList <- VESPAN_species[['DESC_LATIN']]
full_species_list <- c(B_sList, V_sList) %>%
map_chr(append_str2, ' sp', '.') %>%
c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
map_chr(append_str, ' sp.') %>%
c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
map_chr(append_str, ' seedling') %>%
unique() %>%
sort()
spec_list_gs <- gs4_create("fluffy-bunny", sheets = list(All_species = full_species_list))
full_species_df <- data.frame(All_species = full_species_list)
View(full_species_df)
spec_list_gs <- gs4_create("fluffy-bunny", sheets = list(All_species = full_species_df))
install.packages("googledrive")
library(googledrive)
drive_auth()
gs4_auth(token = drive_token())
print(drive_get())
spec_list_gs <- gs4_create("fluffy-bunny", sheets = list(All_species = full_species_df))
print(drive_ls())
drive_ls()
drive_pwd()
drive_cd('test')
drive_find("fluffy-bunny")
drive_cp("fluffy-bunny", google_dir)
google_dir <- 'https://drive.google.com/drive/folders/1dCINS3zQFK0M_YTfwIeVFPEHvVTjQH29'
drive_cp("fluffy-bunny", google_dir)
google_dir <- 'https://drive.google.com/drive/folders/1dCINS3zQFK0M_YTfwIeVFPEHvVTjQH29/'
drive_cp("fluffy-bunny", google_dir)
drive_mv("fluffy-bunny", google_dir)
drive_mv("fluffy-bunny", google_dir)
spec_list_gs <- gs4_create("test2", sheets = list(All_species = full_species_df))
google_dir2 <- 'https://drive.google.com/drive/folders/Computers/Cinnamon-bun/Work/NE_work/Species_list/dataframes/'
drive_mv("test2", google_dir2)
write.csv(full_species_df, paste0(dir, 'full_species_list.csv'))
dat <- read.csv(paste(dir, 'full_species_list.csv', sep=''),
header = TRUE, row.names = 1, sep = ",")
full_species_list2 <- dat[['x']]
View(dat)
full_species_list2 <- dat[['All_species']]
write.csv(full_species_df, paste0(dir, 'full_species_list.csv'), row.names=FALSE)
dat <- read.csv(paste(dir, 'full_species_list.csv', sep=''),
header = TRUE, row.names = 1, sep = ",")
full_species_list2 <- dat[['All_species']][!is.na(dat[['All_species']])]
full_species_list2 <- dat[['All_species']]#[!is.na(dat[['All_species']])]
full_species_list2 <- dat[['All_species']]#[!is.na(dat[['All_species']])]
View(dat)
dat <- read.csv(paste(dir, 'full_species_list.csv', sep=''),
header = TRUE, row.names = 1, sep = ",")
dat <- read.csv(paste(dir, 'full_species_list.csv', sep=''),
header = TRUE, sep = ",")
dat <- read.csv(paste(dir, 'full_species_list.csv', sep=''),
header = TRUE)
full_species_list2 <- dat[['All_species']][!is.na(dat[['All_species']])]
dat <- read.csv(paste(dir, 'full_species_list.csv', sep=''), header = TRUE)
View(dat)
full_species_list3 <- dat[['Added_species']][!is.na(dat[['Added_species']])]
full_species_list2 <- dat[['All_species']][(dat[['All_species']] != '')]
full_species_list3 <- dat[['Added_species']][(dat[['Added_species']] != '')]
full_species_list <- c(dat[['All_species']][!is.na(dat[['All_species']])],
dat[['Added_species']][(dat[['Added_species']] != '')])
name_swap <- read_excel(paste(dir, 'rename.xlsx', sep=''), sheet = "Missing_species")
name_swap <- read.csv(paste0(dir, 'rename.xlsx'))
name_swap <- read.csv(paste0(dir, 'rename.csv'))
View(name_swap)
name_swap_vector <- with(name_swap, setNames(right_name, wrong_name))
print(name_swap_vector[1:5])
laptop_dir <- 'C:/Users/kiera/Work/NE_work/Species_list'
setwd(laptop_dir)
dir <- './dataframes/'
################################################################################
# Functions
################################################################################
rename <- function(input, list_of_species, naming_cutoff = 0.1) {
# Makes automatic name changes where the name is close to the names in a list
# of accepted names in MAVIS
if ( (!input %in% list_of_species) & (!is.na(input)) ) {
list_of_matches <- stringdist(input, list_of_species, method='jw')
if (min(list_of_matches) < naming_cutoff) {
new_name <- list_of_species[which.min(list_of_matches)]
return(new_name)
} else {
return(NA)
}
} else {
return(input)
}
}
append_str <- function(input, suffix) {
# Appends ' sp.' after species names when there is only one word
# because it is a genus
if (!grepl(' ', input)) {
return(paste(input, suffix, sep = ''))
} else {
return(input)
}
}
append_str2 <- function(input, find, suffix) {
# usesd for adding a '.' after a 'sp'
reg <- paste(find, '$', sep='')
if (grepl(reg, input)) {
return(paste(input, suffix, sep = ''))
} else {
return(input)
}
}
################################################################################
# Setup
################################################################################
# BSBI_species <- read_excel(paste(dir, 'BSBI_plant_names.xlsx', sep=''), sheet = "LIST2007")
# B_sList <- BSBI_species[['Species']]
#
# VESPAN_species <- read.csv(paste(dir, 'ECN_VESPAN_dictionary.csv', sep=''))
# V_sList <- VESPAN_species[['DESC_LATIN']]
#
# full_species_list <- c(B_sList, V_sList) %>%
#   map_chr(append_str2, ' sp', '.') %>%
#   c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
#   map_chr(append_str, ' sp.') %>%
#   c(., unique(gsub("([A-Za-z]+).*", "\\1", .))) %>%
#   map_chr(append_str, ' seedling') %>%
#   unique() %>%
#   sort()
#
# full_species_df <- data.frame(All_species = full_species_list)
# spec_list_gs <- gs4_create("full_species_list", sheets = list(All_species = full_species_df))
# drive_mv("full_species_list", google_dir2)
#
# write.csv(full_species_df, paste0(dir, 'full_species_list.csv'), row.names=FALSE)
# Getting out list of all the species that are accepted
dat <- read.csv(paste(dir, 'full_species_list.csv', sep=''), header = TRUE)
# the first column is from BSBI and VESPAN
# the second column is species we have added
full_species_list <- c(dat[['All_species']][!is.na(dat[['All_species']])],
dat[['Added_species']][(dat[['Added_species']] != '')])
name_swap <- read.csv(paste0(dir, 'rename.csv'))
# name_swap <- read_excel(paste(dir, 'rename.xlsx', sep=''), sheet = "Missing_species")
# name_swap_vector <- with(name_swap, setNames(right_name, wrong_name))
# print(name_swap_vector[1:5])
file_dir <- '../Data/'
list_of_files <- list.files(file_dir)
N_files <- length(list_of_files)
print(list_of_files)
survey_list_full = list()
survey_list = list()
sitecode_list = list()
################################################################################
# reading in the data
################################################################################
for (ii in 1:N_files) {
survey_name <- list_of_files[ii]
print(survey_name)
file_path <- paste(file_dir, survey_name, sep='')
species <- read_excel(file_path, sheet = "Species Template")
site <- species[['SITECODE']][1]
year <- species[['YEAR']][1]
survey <- paste(site, year, sep = '_')
species[['DESC_LATIN']] <- trimws(species[['DESC_LATIN']], which = "both")
species[['DESC_LATIN']] <- str_to_sentence(species[['DESC_LATIN']])
survey_list_full[[survey]] <- species[['DESC_LATIN']]
species <- species[!is.na(species[['DESC_LATIN']]), ]
survey_list[[survey]] <- sort(unique(species[['DESC_LATIN']]))
sitecode_list[[ii]] <- site
}
surveys <- names(survey_list)
sitecodes <- unique(unlist(sitecode_list))
################################################################################
# site specific lists
################################################################################
site_list = list()
for (ii in 1:length(sitecodes)) {
site <- sitecodes[[ii]]
survey_nums <- grep(sitecodes[ii], surveys)
site_list[[site]] <- sort(unique(as.vector(unlist(survey_list[survey_nums]))))
#site_list[[site]] <- sort(unique(as.vector(unlist(site_list[[site]]))))
}
all_spec <- list("All species" = sort(unique(as.vector(unlist(site_list)))))
View(all_spec)
all_spec[["All species"]]
all_spec[[1]] <- all_spec[[1]] %>%
map_chr(append_str, ' sp.') %>%
map_chr(append_str2, ' sp', '.') %>%
unique() %>%
mapvalues(name_swap[['wrong_name']], name_swap[['right_name']], warn_missing = FALSE)
all_spec[["All species"]]
species_sheets <- list(All_species = all_spec,
Sites = site_list_df,
Surveys_unique = survey_list_df,
Surveys = survey_list_df)
site_list_df <- data.frame(lapply(site_list, "length<-", max(lengths(site_list))))
survey_list_df <- data.frame(lapply(survey_list, "length<-", max(lengths(survey_list))))
survey_list_df <- data.frame(lapply(survey_list_full, "length<-", max(lengths(survey_list_full))))
species_sheets <- list(All_species = all_spec,
Sites = site_list_df,
Surveys_unique = survey_list_df,
Surveys = survey_list_df)
write.xlsx(species_sheets, file = "Species_lists.xlsx")
